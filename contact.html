
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Contact Us</title>
<style>
body {font-family: Arial; background:#121212; color:#fff; margin:0; padding:0; display:flex; justify-content:center; align-items:center; height:100vh;}
.container {background:#1e1e1e; padding:30px; border-radius:10px; width:400px; box-shadow:0 0 20px rgba(0,0,0,0.7);}
h2 {text-align:center; color:#E50914; margin-bottom:20px;}
textarea {width:100%; height:100px; margin-bottom:15px; border-radius:5px; border:none; padding:10px; resize:none;}
input, button {padding:10px; width:100%; margin-bottom:10px; border-radius:5px; border:none;}
button {background:#E50914; color:#fff; font-weight:bold; cursor:pointer;}
button:hover {background:#ff1a2c;}
.message {padding:8px; margin-bottom:5px; border-radius:5px;}
.message.user {background:#333; text-align:right;}
.message.admin {background:#4CAF50; text-align:left;}
#messages {max-height:300px; overflow-y:auto; margin-bottom:15px;}
</style>
</head>
<body>
<div class="container">
  <h2>Contact Us</h2>
  <input type="email" id="email" placeholder="Your Email" required>
  <div id="messages"></div>
  <textarea id="text" placeholder="Type your message..."></textarea>
  <button id="sendBtn">Send</button>
</div>

<script>
const emailInput = document.getElementById('email');
const textInput = document.getElementById('text');
const sendBtn = document.getElementById('sendBtn');
const messagesDiv = document.getElementById('messages');

async function loadMessages() {
    if(!emailInput.value) return;
    const res = await fetch('/get_messages', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({email: emailInput.value})
    });
    const data = await res.json();
    messagesDiv.innerHTML = '';
    data.messages.forEach(m => {
        const div = document.createElement('div');
        div.className = 'message ' + m.from;
        div.textContent = m.text + " [" + new Date(m.timestamp).toLocaleTimeString() + "]";
        messagesDiv.appendChild(div);
    });
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

sendBtn.addEventListener('click', async () => {
    if(!emailInput.value || !textInput.value) return alert("Email & message required");
    const res = await fetch('/send_message', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({email: emailInput.value, text: textInput.value})
    });
    const data = await res.json();
    if(data.success){
        textInput.value = '';
        loadMessages();
    }
});

emailInput.addEventListener('change', loadMessages);
setInterval(loadMessages, 3000); // live updates
</script>
</body>
</html>
